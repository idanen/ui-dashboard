<div class="stability-container container-fluid">
  <!--<h2>build: {{ $ctrl.build.name }}#{{ $ctrl.build.number }}</h2>-->
  <div class="row">
    <h3 class="col-xs-6">Tests Stability</h3>
    <div class="col-xs-4 pull-right compare-legend-container">
      <paper-icon-button class="pull-right compare-legend-opener" icon="help" title="Show legend" ng-click="$ctrl.toggleLegend()"></paper-icon-button>
      <div class="compare-legend" ng-class="$ctrl.legendShown ? 'compare-legend-open' : ''">
        <p>
          When clicking &quot;Go!&quot; The page retrieves the stability statistics of the branch‘s last <code>N</code> failed tests (Aborted are ignored)
          When clicking &quot;Add&quot; near the build selector – all failed test of the selected build are added. (Build Name and/or Build number), &quot;GO!&quot; is required afterwards.
          Individual tests may be fetched as well by specifying its Class & Method
        </p>
      </div>
    </div>
  </div>

  <form class="form-horizontal" name="$ctrl.settings">
    <fieldset class="form-group">
      <label class="col-md-3">Previous builds count <iron-icon icon="info-outline" uib-tooltip="Calculate stability of the last {{$ctrl.buildsCount}} builds (NOTE: that this is not related to the selected build id below)"></iron-icon></label>
      <div class="col-md-3">
        <paper-slider pin min="10" max="50" bind-from="$ctrl.buildsCount" on-update="$ctrl.buildsCountUpdated(value)" style="width: 100%;"></paper-slider>
      </div>
      <div class="col-md-1">
        <input class="form-control" type="number" ng-model="$ctrl.buildsCount">
      </div>
    </fieldset>
    <fieldset class="form-group">
      <label class="col-xs-2">Manual</label>
      <div class="col-xs-4">
        <paper-input-container>
          <label>Test Class (full quelified name)</label>
          <input is="iron-input" ng-model="$ctrl.newTest.testClass">
        </paper-input-container>
      </div>
      <div class="col-xs-4">
        <paper-input-container>
          <label>Test Name (comma separated)</label>
          <input is="iron-input" ng-model="$ctrl.newTest.methods">
        </paper-input-container>
      </div>
      <div class="col-xs-2">
        <paper-button raised ng-click="$ctrl.addNewTest()">
          <iron-icon icon="add"></iron-icon>
          <span>Add test</span>
        </paper-button>
      </div>
    </fieldset>
    <fieldset class="form-group">
      <label class="col-md-2">Failed tests of</label>
      <div class="col-md-8">
        <build-selector groups="$ctrl.availableGroups"
                        builds="$ctrl.availableBuilds[$ctrl.build.group]"
                        selected="$ctrl.build"
                        on-change="$ctrl.selectionChanged(prop, value)"></build-selector>
      </div>
      <div class="col-md-2">
        <paper-button raised class="ladda-button" ladda="$ctrl.reFetchLoading" ng-click="$ctrl.fetchFailedOfBuild()" uib-tooltip="Add failed tests of last {{ $ctrl.buildsCount }} builds starting from the selected">
          <iron-icon icon="add"></iron-icon>
          <span>Add all</span>
        </paper-button>
      </div>
    </fieldset>
    <fieldset class="form-group">
      <div class="col-xs-10">
        <paper-button class="under-construction" raised ng-click="$ctrl.selectAll()">
          <iron-icon icon="done"></iron-icon>
          select all
        </paper-button>
        <paper-button class="under-construction" raised ng-click="$ctrl.selectNone()">
          <iron-icon icon="clear"></iron-icon>
          select none
        </paper-button>
        <paper-button class="text-danger" raised ng-click="$ctrl.clearAll()">
          <iron-icon icon="block"></iron-icon>
          clear all
        </paper-button>
      </div>
      <div class="col-xs-2">
        <paper-button raised class="btn-run-stability ladda-button" ladda="$ctrl.goLoading" ng-click="$ctrl.fetchStability()">
          <iron-icon icon="send"></iron-icon>
          <span>Go!</span>
        </paper-button>
      </div>
    </fieldset>
    <fieldset class="form-group">
      <label class="col-xs-12">Show above</label>
      <paper-slider pin min="0" max="1" step="0.1" bind-from="$ctrl.filterFailedPercent" on-update="$ctrl.filterFailedPercentChanged(value)"></paper-slider>
    </fieldset>
    <div class="row">
      <div class="col-md-4">
        <strong>Test Class</strong>
      </div>
      <div class="col-md-4">
        <strong>Test Name (method)</strong>
      </div>
      <div class="col-md-4">
        <strong>Results</strong>
        <paper-icon-button raised icon="block" ng-click="$ctrl.clearResults()" uib-tooltip="Clear results"></paper-icon-button>
      </div>
    </div>
    <fieldset class="form-group">
      <div class="row slide-in" ng-repeat="test in $ctrl.tests | stabilityFilter:$ctrl.filterFailedPercent">
        <div class="col-md-4">
          <paper-icon-button icon="clear" ng-click="$ctrl.removeTest(test.testClass)"></paper-icon-button>
          <label>
            <input class="under-construction" type="checkbox" ng-model="test.selected">
            <span uib-tooltip="{{ test.testClass }}"> {{ test.testClass | className }}</span>
          </label>
        </div>
        <div class="col-md-4">
          <ul class="list-group borderless">
            <li class="list-group-item" ng-repeat="testMethod in test.methods track by $index">
              <span>{{ testMethod }}</span>
            </li>
          </ul>
        </div>
        <div class="col-md-4">
          <ul class="list-group" ng-if="test.results">
            <li class="list-group-item" ng-repeat="(testName, result) in test.results">
              <uib-progressbar class="progress-striped" max="result.count" value="result.failed" type="{{result.stability > 0.3 ? 'danger' : 'warning'}}">
                <span class="text-success test-result-stable" ng-if="result.failed === 0"><iron-icon icon="done-all"></iron-icon> Stable</span>
                <em ng-if="result.failed > 0" uib-tooltip="{{ result.failed }} / {{ result.count }} ({{ result.stability | percentage:0 }})">{{ result.failed }} / {{ result.count }} ({{ result.stability | percentage:0 }})</em>
              </uib-progressbar>
            </li>
          </ul>
        </div>
      </div>
    </fieldset>
    <fieldset class="form-group">
      <div class="col-xs-offset-10 col-xs-2">
        <paper-button raised class="btn-run-stability ladda-button" ladda="$ctrl.goLoading" ng-click="$ctrl.fetchStability()">
          <iron-icon icon="send"></iron-icon>
          <span>Go!</span>
        </paper-button>
      </div>
    </fieldset>
  </form>

  <!--<ul class="list-group">-->
    <!--<li class="list-group-item" ng-repeat="test in $ctrl.tests">-->
      <!--<span>{{test.testClass}}</span>-->
      <!--<ul class="list-group">-->
        <!--<li class="list-group-item" ng-repeat="(testName, result) in test.results">-->
          <!--<span>{{testName}}</span>-->
          <!--<uib-progressbar class="progress-striped" max="result.count" value="result.failed" type="{{result.stability > 0.3 ? 'danger' : 'warning'}}">-->
            <!--<span class="text-success test-result-stable" ng-if="result.failed === 0"><iron-icon icon="done-all"></iron-icon> Stable</span>-->
            <!--<em ng-if="result.failed > 0">{{ result.failed }} / {{ result.count }} ({{ result.stability | percentage:0 }})</em>-->
          <!--</uib-progressbar>-->
        <!--</li>-->
      <!--</ul>-->
    <!--</li>-->
  <!--</ul>-->
  <!--<code>-->
    <!--<pre>{{$ctrl.stability | json}}</pre>-->
  <!--</code>-->
</div>
